!function(){"use strict";if("function"!=typeof Chess||!window.PGNCore)return;var e=window.PGNCore,t="function"==typeof window.Chessboard,n=0;function r(e,t){if(!t||!e||!window.Chessboard)return;var r="pgn-diagram-"+n++,o=document.createElement("div");o.className="pgn-diagram",o.id=r,e.appendChild(o);try{Chessboard(r,{position:t,draggable:!1,pieceTheme:e.PIECE_THEME_URL})}catch(e){}}function o(t){return e.SAN_CORE_REGEX.test(t)}function a(e){var t=e.split(/\r?\n/),n=[],r=[],o=!0;return t.forEach(function(e){var t=e.trim();o&&t.startsWith("[")&&t.endsWith("]")?n.push(e):o&&""===t?o=!1:(o=!1,r.push(e))}),{headers:n,moveText:r.join(" ").replace(/\s+/g," ").trim()}}function i(e,t){t&&e.appendChild(document.createTextNode(t))}function s(t){this.sourceEl=t,this.wrapper=document.createElement("div"),this.wrapper.className="pgn-blog-block",this.finalResultPrinted=!1,this.build(),this.applyFigurines()}s.prototype.build=function(){var t="";try{t=this.sourceEl.textContent.trim()}catch(e){return}t=e.normalizeFigurines(t);var n=a(t),o=n.headers,s=n.moveText,l=(o.length?o.join("\n")+"\n\n":"")+s,c=new Chess;try{c.load_pgn(l,{sloppy:!0})}catch(e){}var u={};try{u=c.header?c.header():{}}catch(e){}var d=e.normalizeResult(u.Result||""),p=/ (1-0|0-1|1\/2-1\/2|½-½|\*)$/.test(s),m=p?s:s+(d?" "+d:"");this.header(u),this.parse(m);try{this.sourceEl.replaceWith(this.wrapper)}catch(e){this.sourceEl.parentNode&&this.sourceEl.parentNode.replaceChild(this.wrapper,this.sourceEl)}},s.prototype.header=function(t){var n=document.createElement("h3"),r=(t.WhiteTitle?t.WhiteTitle+" ":"")+e.flipName(t.White||"")+(t.WhiteElo?" ("+t.WhiteElo+")":""),o=(t.BlackTitle?t.BlackTitle+" ":"")+e.flipName(t.Black||"")+(t.BlackElo?" ("+t.BlackElo+")":""),a=e.extractYear(t.Date),s=(t.Event||"")+(a?", "+a:"");i(n,r+" – "+o),n.appendChild(document.createElement("br")),i(n,s),this.wrapper.appendChild(n)},s.prototype.ensure=function(e,t){e.container||(e.container=document.createElement("p"),e.container.className=t,this.wrapper.appendChild(e.container))},s.prototype.parseComment=function(t,n,o){for(var a=n;a<t.length&&"}"!==t[a];)a++;var s=t.substring(n,a).trim();"}"===t[a]&&a++,s=s.replace(/\[%.*?]/g,"").trim();if(!s.length)return a;for(var l=s.split("[D]"),c=0;c<l.length;c++){var u=l[c].trim();if("variation"===o.type){this.ensure(o,"pgn-variation"),u&&i(o.container," "+u)}else{if(u){var d=document.createElement("p");d.className="pgn-comment",i(d,u),this.wrapper.appendChild(d)}o.container=null}c<l.length-1&&r(this.wrapper,o.chess.fen())}return o.lastWasInterrupt=!0,a},s.prototype.handleSAN=function(t,n){var r=t.replace(/[^a-hKQRBN0-9=O0-]+$/g,"").replace(/0/g,"O");if(!o(r))return i(n.container,t+" "),null;var a=n.baseHistoryLen||0,s=n.chess.history().length,l=a+s,c=0==l%2,u=Math.floor(l/2)+1;c?i(n.container,u+"."+e.NBSP):n.lastWasInterrupt&&i(n.container,u+"..."+e.NBSP),n.prevFen=n.chess.fen(),n.prevHistoryLen=l;var d=null;try{d=n.chess.move(r,{sloppy:!0})}catch(e){}if(!d)return i(n.container,t+" "),null;n.lastWasInterrupt=!1;var p=document.createElement("span");return p.className="pgn-move",p.textContent=e.makeCastlingUnbreakable(t)+" ",n.container.appendChild(p),p},s.prototype.parse=function(t){var n=new Chess,r={type:"main",chess:n,container:null,parent:null,lastWasInterrupt:!1,prevFen:n.fen(),prevHistoryLen:0,baseHistoryLen:null},o=0;for(;o<t.length;){var a=t[o];if(/\s/.test(a)){for(;o<t.length&&/\s/.test(t[o]);)o++;this.ensure(r,"main"===r.type?"pgn-mainline":"pgn-variation"),i(r.container," ");continue}if("("===a){o++;var s=r.prevFen||r.chess.fen(),l="number"==typeof r.prevHistoryLen?r.prevHistoryLen:r.chess.history().length;r={type:"variation",chess:new Chess(s),container:null,parent:r,lastWasInterrupt:!0,prevFen:s,prevHistoryLen:l,baseHistoryLen:l},this.ensure(r,"pgn-variation");continue}if(")"===a){o++,r.parent&&(r=r.parent,r.lastWasInterrupt=!0,r.container=null);continue}if("{"===a){o=this.parseComment(t,o+1,r);continue}for(var c=o;o<t.length&&!/\s/.test(t[o])&&-1==="(){}".indexOf(t[o]);)o++;var u=t.substring(c,o);if(!u)continue;if(/^\[%.*]$/.test(u))continue;if("[D]"===u){r(this.wrapper,r.chess.fen()),r.lastWasInterrupt=!0,r.container=null;continue}if(e.RESULT_REGEX.test(u)){this.finalResultPrinted||(this.finalResultPrinted=!0,this.ensure(r,"main"===r.type?"pgn-mainline":"pgn-variation"),i(r.container,u+" "));continue}if(e.MOVE_NUMBER_REGEX.test(u))continue;var d=u.replace(/[^a-hKQRBN0-9=O0-]+$/g,"").replace(/0/g,"O"),p=o(d);if(!p){if(e.EVAL_MAP[u]){this.ensure(r,"main"===r.type?"pgn-mainline":"pgn-variation"),i(r.container,e.EVAL_MAP[u]+" ");continue}if("$"===u[0]){var m=+u.slice(1);e.NAG_MAP[m]&&(this.ensure(r,"main"===r.type?"pgn-mainline":"pgn-variation"),i(r.container,e.NAG_MAP[m]+" "));continue}if(/[A-Za-zÇĞİÖŞÜçğıöşü]/.test(u))"variation"===r.type?(this.ensure(r,"pgn-variation"),i(r.container," "+u)):(function(){var t=document.createElement("p");t.className="pgn-comment",i(t,u),this.wrapper.appendChild(t)}).call(this),r.container=null,r.lastWasInterrupt=!1;else this.ensure(r,"main"===r.type?"pgn-mainline":"pgn-variation"),i(r.container,u+" ");continue}this.ensure(r,"main"===r.type?"pgn-mainline":"pgn-variation");var f=this.handleSAN(u,r);f||i(r.container,e.makeCastlingUnbreakable(u)+" ")}},s.prototype.applyFigurines=function(){if(this.wrapper.__pgnFigurined)return;this.wrapper.__pgnFigurined=!0;var e={K:"♔",Q:"♕",R:"♖",B:"♗",N:"♘"};this.wrapper.querySelectorAll(".pgn-move").forEach(function(t){var n=t.textContent.match(/^([KQRBN])(.+?)(\s*)$/);n&&(t.textContent=e[n[1]]+n[2]+(n[3]||""))})};function l(){document.querySelectorAll("pgn").forEach(function(e){e.__pgnRendered||(e.__pgnRendered=!0,new s(e))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l,{once:!0}):l()}();